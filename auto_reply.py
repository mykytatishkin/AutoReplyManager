from pyrogram import Client, filters
from datetime import datetime

# –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ Telegram API
api_id = "9902235"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à API ID
api_hash = "53b2a875f92fa666abb1493b9ccc8eab"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à API Hash

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
WORK_HOURS = {
    'start': (11, 0),  # –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã: 11:00
    'end': (19, 0),  # –ö–æ–Ω–µ—Ü —Ä–∞–±–æ—Ç—ã: 19:00
    'work_days': range(0, 7),  # –†–∞–±–æ—á–∏–µ –¥–Ω–∏: –ü–ù=0, ..., –ü–¢=4
}

HOLIDAY_DATES = [
    (12, 30),  # 30 –¥–µ–∫–∞–±—Ä—è
    (12, 31),  # 31 –¥–µ–∫–∞–±—Ä—è
    (1, 1),    # 1 —è–Ω–≤–∞—Ä—è
    (1, 2),    # 2 —è–Ω–≤–∞—Ä—è
    (1, 3),    # 3 —è–Ω–≤–∞—Ä—è
]

AUTO_REPLY_MESSAGE = (
    "–î–æ–±—Ä–æ–≥–æ –¥–Ω—èüéÖ\n"
    "–í—ñ—Ç–∞—î–º–æ –í–∞—Å —ñ–∑ –ù–æ–≤–æ—Ä—ñ—á–Ω–∏–º–∏ —Å–≤—è—Ç–∞–º–∏!üéÑ\n"
    "–ù–∞–≥–∞–¥—É—î–º–æ, —â–æ –ª–∏—à–µ 5 –¥–Ω—ñ–≤ –Ω–∞ —Ä—ñ–∫–∑ 30.12.2023 –ø–æ 03.01.2024 (–≤–∫–ª—é—á–Ω–æ) –∫—É—Ä–∞—Ç–æ—Ä–∏ –≤–∏—Ö—ñ–¥–Ω—ñ.\n"
    "–í–∏ –º–æ–∂–µ—Ç–µ –Ω–∞—Ä–∞–∑—ñ –Ω–∞–ø–∏—Å–∞—Ç–∏ –≤—Å—ñ –≤–∞—à—ñ –ø–∏—Ç–∞–Ω–Ω—è –≤ —á–∞—Ç —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤ –ø–µ—Ä—à—É —á–µ—Ä–≥—É\n"
    "–ú–∏ –¥–æ–ø–æ–º–æ–∂–µ–º–æ –í–∞–º –≤–∏—Ä—ñ—à–∏ –≤—Å—ñ –í–∞—à—ñ –ø–∏—Ç–∞–Ω–Ω—è –∑ 04.01.2024 –∑–∞ –≥—Ä–∞—Ñ—ñ–∫–æ–º –∑ 11:00 –¥–æ 19:00 –±–µ–∑ –≤–∏—Ö—ñ–¥–Ω–∏—Öü§ù \n"
    "–ë–∞–∂–∞—î–º–æ –≤–∞–º —á—É–¥–æ–≤–∏—Ö —Å–≤—è—Ç —ñ –∑–∞—Ä—è–¥—É –µ–Ω–µ—Ä–≥—ñ—ó –Ω–∞ –Ω–æ–≤–∏–π —Ä—ñ–∫! üéâ\n"
)


def is_working_time() -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —Ä–∞–±–æ—á–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ."""
    now = datetime.now()
    current_time = (now.hour, now.minute)
    current_day = now.weekday()

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏
    if (now.month, now.day) in HOLIDAY_DATES:
        return False

    start_time = WORK_HOURS['start']
    end_time = WORK_HOURS['end']

    return (start_time <= current_time <= end_time) and (current_day in WORK_HOURS['work_days'])


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
app = Client("manager_account", api_id=api_id, api_hash=api_hash)


@app.on_message(filters.private & ~filters.me)
async def auto_reply(client, message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π."""
    if not is_working_time():
        await message.reply_text(AUTO_REPLY_MESSAGE)


def main():
    # –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    app.run()


if __name__ == "__main__":
    main()